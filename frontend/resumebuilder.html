<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#1e40af',
                    }
                }
            }
        }
    </script>

<style>
    :root {
        --primary-color: #2563eb;
        --secondary-color: #1e40af;
        --text-color: #334155;
        --light-gray: #f1f5f9;
        --white: #ffffff;
        --border-color: #e2e8f0;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: var(--light-gray);
        color: var(--text-color);
        line-height: 1.6;
    }

    /* Header Styles */
    header {
        background: var(--white);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
    }

    .nav-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
    }

    .logo img {
        width: 40px;
        height: auto;
    }

    .logo-text {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .nav-links {
        display: flex;
        gap: 30px;
    }

    .nav-links a {
        color: var(--text-color);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }

    .nav-links a:hover {
        color: var(--primary-color);
    }

    .nav-right {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .user-menu {
        position: relative;
    }

    .user-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--white);
        cursor: pointer;
        transition: all 0.3s;
    }

    .user-button:hover {
        border-color: var(--primary-color);
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--primary-color);
        color: var(--white);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
    }

    .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: var(--white);
        border: 1px solid var(--border-color);
        border-radius: 4px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        min-width: 200px;
        display: none;
    }

    .user-dropdown.active {
        display: block;
    }

    .user-dropdown a {
        display: block;
        padding: 12px 16px;
        color: var(--text-color);
        text-decoration: none;
        transition: background-color 0.3s;
    }

    .user-dropdown a:hover {
        background-color: var(--light-gray);
    }

    .user-dropdown .divider {
        height: 1px;
        background: var(--border-color);
        margin: 8px 0;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .nav-links {
            display: none;
        }

        .user-button span {
            display: none;
        }
    }

    /* Two-Panel Layout */
    .main-container {
        display: flex;
        height: calc(100vh - 70px);
    }

    .left-panel {
        width: 50%;
        overflow-y: auto;
        padding: 2rem;
        background-color: var(--light-gray);
    }

    .right-panel {
        width: 50%;
        background-color: var(--white);
        overflow: auto;
        color: var(--text-color);
        padding: 2rem;
        position: sticky;
        top: 70px;
        height: calc(100vh - 70px);
    }

    /* Preview Toggle Button */
    .preview-toggle {
        display: none;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary-color);
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        border: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        z-index: 1000;
        font-weight: 600;
    }

    .preview-toggle:hover {
        background: var(--secondary-color);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .main-container {
            flex-direction: column;
            height: auto;
        }

        .left-panel {
            width: 100%;
            height: auto;
        }

        .right-panel {
            width: 100%;
            height: auto;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }

        .right-panel.active {
            transform: translateX(0);
        }

        .preview-toggle {
            display: block;
        }

        .preview-toggle.active {
            background: var(--secondary-color);
        }
    }

    /* Section Styling */
    .section-block {
        margin-bottom: 3rem;
    }

    .section-header {
        font-size: 1.5rem;
        margin-bottom: 1rem;
        color: var(--text-color);
    }
    
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-top: 1rem;
    }

    .input-group {
        display: flex;
        flex-direction: column;
    }

    .input-group label {
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-color);
    }

    .input-group input,
    .input-group textarea {
        padding: 0.75rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 5px;
        font-size: 1rem;
        width: 100%;
        background-color: var(--white);
    }

    .input-group input:focus,
    .input-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }

    .input-group textarea {
        resize: vertical;
        font-family: inherit;
        min-height: 100px;
        max-height: 300px;
        overflow-y: auto;
        word-wrap: break-word;
        white-space: pre-wrap;
        line-height: 1.5;
    }

    .full-width {
        grid-column: span 2;
    }

    /* Responsive Form Styles */
    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .full-width {
            grid-column: span 1;
        }

        .input-group {
            margin-bottom: 0.5rem;
        }

        .input-group input,
        .input-group textarea {
            font-size: 16px; /* Prevents zoom on iOS */
            padding: 0.875rem 1rem;
        }

        .section-block {
            margin-bottom: 2rem;
            padding: 0 1rem;
        }

        .section-header {
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }

        .left-panel {
            padding: 1rem 0;
        }

      
        button, 
        .btn {
            min-height: 44px;
            padding: 0.75rem 1.5rem;
        }

       
        .tech-skills-grid {
            grid-template-columns: 1fr;
        }

     
        .cert-grid {
            grid-template-columns: 1fr;
        }

        /* Make project items more mobile-friendly */
        .project-item {
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .project-tech-stack {
            gap: 0.5rem;
        }

        .tech-badge {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }
    }

    /* Small mobile devices */
    @media (max-width: 480px) {
        .section-block {
            padding: 0 0.75rem;
        }

        .input-group input,
        .input-group textarea {
            padding: 0.75rem;
        }

        .section-header {
            font-size: 1.125rem;
        }
    }

    /* Template-specific styles */
    .it-template {
        --tech-skill-bg: #e2e8f0;
        --cert-bg: #f8fafc;
        --project-bg: #ffffff;
    }

    .tech-skills-section {
        background: var(--tech-skill-bg);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .tech-skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .skill-category {
        margin-bottom: 1rem;
    }

    .skill-category h4 {
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }

    .certifications-section {
        background: var(--cert-bg);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .cert-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
    }

    .cert-item {
        background: white;
        padding: 1rem;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .projects-section {
        background: var(--project-bg);
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .project-item {
        margin-bottom: 1.5rem;
        padding: 1rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
    }

    .project-tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .tech-badge {
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.875rem;
    }

    /* Template content containers */
    .template-content {
        display: none;
    }

    .template-content.active {
        display: block;
    }

    /* IT Template 1 Styles */
    .resume-container {
        max-width: 210mm;
        margin: 0 auto;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        color: #1f2937;
        line-height: 1.6;
    }

    .header {
        background: #2563eb;
        color: white;
        padding: 3rem 2rem;
        text-align: center;
        position: relative;
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .header h2 {
        color: #1e40af;
        font-size: 1.5rem;
        font-weight: 500;
        margin-bottom: 1.5rem;
    }

    .contact-info {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .contact-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #1f2937;
    }

    .section {
        margin-bottom: 2rem;
    }

    .section-title {
        color: #2563eb;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e5e7eb;
    }

    .tech-skills {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .skill-category {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 6px;
    }

    .skill-category h4 {
        color: #1e40af;
        margin-bottom: 0.5rem;
    }

    .skill-list {
        list-style: none;
    }

    .skill-list li {
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .skill-list li::before {
        content: "‚Ä¢";
        color: #2563eb;
    }

    .experience-item {
        margin-bottom: 1.5rem;
    }

    .experience-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .experience-title {
        font-weight: 600;
        color: #1e40af;
    }

    .experience-date {
        color: #666;
    }

    .experience-company {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    .experience-description {
        margin-left: 1rem;
    }

    .projects {
        display: grid;
        gap: 1.5rem;
    }

    .project-item {
        background: #f8fafc;
        padding: 1rem;
        border-radius: 6px;
    }

    .project-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .project-title {
        font-weight: 600;
        color: #1e40af;
    }

    .tech-stack {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }

    .tech-badge {
        background: #2563eb;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.875rem;
    }

    /* Template-specific styles */
    .it-template-1-preview {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #334155;
        line-height: 1.6;
        padding: 2rem;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .it-template-1-preview .preview-header {
        text-align: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #2563eb;
    }

    .it-template-1-preview h1 {
        font-size: 2.5rem;
        color: #2563eb;
        margin-bottom: 0.5rem;
    }

    .it-template-1-preview h2 {
        font-size: 1.5rem;
        color: #64748b;
        margin-bottom: 1rem;
    }

    .it-template-1-preview .contact-info {
        display: flex;
        justify-content: center;
        gap: 2rem;
        color: #64748b;
    }

    .it-template-1-preview .preview-summary {
        margin-bottom: 2rem;
    }

    .it-template-1-preview h3 {
        font-size: 1.25rem;
        color: #2563eb;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .it-template-1-preview .preview-skills {
        margin-bottom: 2rem;
    }

    .it-template-1-preview .skill-category-preview {
        margin-bottom: 1rem;
    }

    .it-template-1-preview .skill-category-preview h4 {
        font-size: 1.1rem;
        color: #64748b;
        margin-bottom: 0.5rem;
    }

    .it-template-1-preview .skill-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .it-template-1-preview .skill-badge {
        background: #e2e8f0;
        color: #334155;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.875rem;
    }

    .it-template-1-preview .preview-experience {
        margin-bottom: 2rem;
    }

    .it-template-1-preview .experience-item-preview {
        margin-bottom: 1.5rem;
    }

    .it-template-1-preview .experience-item-preview h4 {
        font-size: 1.1rem;
        color: #2563eb;
        margin-bottom: 0.25rem;
    }

    .it-template-1-preview .experience-item-preview h5 {
        font-size: 1rem;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .it-template-1-preview .experience-item-preview .date {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .it-template-1-preview .experience-item-preview p {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
        white-space: pre-wrap;
        line-height: 1.5;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    .it-template-1-preview .preview-projects {
        margin-bottom: 2rem;
    }

    .it-template-1-preview .project-item-preview {
        margin-bottom: 1.5rem;
    }

    .it-template-1-preview .project-item-preview h4 {
        font-size: 1.1rem;
        color: #2563eb;
        margin-bottom: 0.25rem;
    }

    .it-template-1-preview .project-item-preview .tech-stack {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
    }

    .it-template-1-preview .project-item-preview p {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
        white-space: pre-wrap;
        line-height: 1.5;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    .it-template-1-preview .preview-summary p {
        color: #64748b;
        font-size: 0.875rem;
        line-height: 1.6;
        word-wrap: break-word;
        white-space: pre-wrap;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    /* Default template preview styles */
    .default-template-preview {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #334155;
        line-height: 1.6;
        padding: 2rem;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .default-template-preview .preview-header {
        text-align: left;
        margin-bottom: 2rem;
    }

    .default-template-preview h1 {
        font-size: 2rem;
        color: #334155;
        margin-bottom: 0.5rem;
    }

    .default-template-preview h2 {
        font-size: 1.25rem;
        color: #64748b;
        margin-bottom: 1rem;
    }

    .default-template-preview .contact-info {
        display: flex;
        gap: 2rem;
        color: #64748b;
    }

    .default-template-preview .preview-summary {
        margin-bottom: 2rem;
    }

    .default-template-preview h3 {
        font-size: 1.25rem;
        color: #334155;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .default-template-preview .preview-summary p {
        color: #64748b;
        font-size: 0.875rem;
        line-height: 1.6;
        word-wrap: break-word;
        white-space: pre-wrap;
        max-width: 100%;
        overflow-wrap: break-word;
    }

    /* Responsive preview styles */
    @media (max-width: 768px) {
        .it-template-1-preview,
        .default-template-preview,
        .resume-container {
            padding: 1rem;
        }

        .it-template-1-preview h1,
        .header h1 {
            font-size: 2rem;
        }

        .it-template-1-preview h2,
        .header h2 {
            font-size: 1.25rem;
        }

        .it-template-1-preview .contact-info,
        .contact-info {
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }

        .default-template-preview .contact-info {
            flex-direction: column;
            gap: 0.5rem;
        }

        .tech-skills {
            grid-template-columns: 1fr;
        }

        .experience-header,
        .project-header {
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Improve text handling on mobile */
        .it-template-1-preview .experience-item-preview p,
        .it-template-1-preview .project-item-preview p,
        .it-template-1-preview .preview-summary p,
        .default-template-preview .preview-summary p,
        .experience-description p,
        .project-item p {
            font-size: 0.8rem;
            line-height: 1.4;
            word-break: break-word;
        }

        /* Ensure textareas don't overflow on mobile */
        .input-group textarea {
            font-size: 16px; /* Prevents zoom on iOS */
            min-height: 80px;
            max-height: 200px;
        }
    }

    /* Add profile picture styles */
    .profile-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .profile-preview {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
        background-color: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .profile-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-preview .placeholder {
        color: #64748b;
        font-size: 3rem;
    }

    .profile-upload input[type="file"] {
        display: none;
    }

    .profile-upload label {
        background: var(--primary-color);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .profile-upload label:hover {
        background: var(--secondary-color);
    }

    .profile-upload .remove-photo {
        color: #ef4444;
        cursor: pointer;
        font-size: 0.875rem;
        display: none;
    }

    .profile-upload .remove-photo.active {
        display: block;
    }

    /* Update preview styles for profile picture */
    .it-template-1-preview .profile-picture {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        margin: 0 auto 1rem;
        overflow: hidden;
        border: 3px solid #2563eb;
    }

    .it-template-1-preview .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-picture {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        border: 4px solid white;
        margin: 0 auto 1.5rem;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .default-template-preview .profile-picture {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin-bottom: 1rem;
        overflow: hidden;
        border: 2px solid #e2e8f0;
    }

    .default-template-preview .profile-picture img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

  
    .ai-enhance-btn {
        position: absolute;
        right: 10px;
        top: 10px;
        background: #4CAF50;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .ai-enhance-btn:hover {
        background: #45a049;
    }

    .ai-enhance-btn.loading {
        background: #666;
        cursor: not-allowed;
    }

    .ai-enhance-popup {
        display: none;
        position: absolute;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        width: 300px;
        z-index: 1000;
        right: 0;
        top: 100%;
        margin-top: 5px;
    }

    .regenerate-btn {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        margin-top: 10px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
    }

    .regenerate-btn:hover {
        background: #45a049;
    }

    .regenerate-btn.loading {
        background: #666;
        cursor: not-allowed;
    }

    .ai-suggestion {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .ai-suggestion:hover {
        background: #f5f5f5;
        border-color: #4CAF50;
    }

    .ai-suggestion:last-child {
        margin-bottom: 0;
    }

    .ai-loading {
        text-align: center;
        color: #666;
        padding: 10px;
    }

    .ai-loading::after {
        content: '...';
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { content: '.'; }
        33% { content: '..'; }
        66% { content: '...'; }
    }

    /* Add these styles for the skill badges */
    .skill-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background-color: #e5e7eb;
        color: #374151;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
    }

    .skill-badge:hover {
        background-color: #d1d5db;
    }

    .remove-skill-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1.25rem;
        height: 1.25rem;
        border-radius: 9999px;
        background-color: #9ca3af;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .remove-skill-btn:hover {
        background-color: #6b7280;
    }

    /* Animation for adding/removing skills */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .skill-badge {
        animation: fadeIn 0.2s ease-out;
    }
</style>

</head>

<body>
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-8">
                    <a href="dashboard.html" class="flex items-center space-x-2">
                        <img src="../assets/img/logo.png" alt="ResumeGo Logo" class="w-10 h-auto">
                        <span class="text-xl font-bold text-primary">ResumeGo!</span>
                    </a>
                    <div class="hidden md:flex space-x-8">
                        <a href="dashboard.html" class="text-gray-700 hover:text-primary font-medium">Dashboard</a>
                        <a href="templates.html" class="text-gray-700 hover:text-primary font-medium">Templates</a>
                        <a href="resumebuilder.html" class="text-gray-700 hover:text-primary font-medium">Create Resume</a>
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center space-x-2 px-4 py-2 border border-gray-200 rounded-md hover:border-primary transition-colors">
                            <div id="userAvatar" class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-semibold">U</div>
                            <span id="userName" class="hidden md:inline">User Name</span>
                        </button>
                        <div id="userDropdown" class="user-dropdown absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg border border-gray-200">
                            <a href="profile.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">Profile Settings</a>
                            <a href="my-resumes.html" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">My Resumes</a>
                            <div class="border-t border-gray-200 my-1"></div>
                            <a href="#" id="logoutButton" class="block px-4 py-3 text-gray-700 hover:bg-gray-50">Logout</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-container">
    <div class="left-panel">
            <!-- Profile Picture Upload -->
            <div class="section-block">
                <h2 class="section-header">Profile Picture</h2>
                <div class="profile-upload">
                    <div class="profile-preview" style="width: 150px; height: 150px; border-radius: 50%; overflow: hidden; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                        <img src="" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <button type="button" onclick="openModal()" class="cursor-pointer bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Upload Photo</button>
                    <input type="file" id="profile-upload" accept="image/*" style="display: none;">
                    <span class="remove-photo">Remove Photo</span>
                </div>
            </div>

            <!-- Profile Editor Modal -->
            <div id="profileEditorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; overflow-y: auto;">
                <div style="background: white; width: 95%; max-width: 800px; margin: 20px auto; padding: 20px; border-radius: 8px; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <h2 style="font-size: clamp(20px, 4vw, 24px); font-weight: 600; color: #333;">Profile Photo Editor</h2>
                            <p style="color: #666; font-size: clamp(14px, 2vw, 16px);">Crop and apply professional suit overlay for your resume</p>
                        </div>
                        <button onclick="closeModal()" style="background: none; border: none; cursor: pointer; font-size: 24px; padding: 5px;">√ó</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <!-- Image Preview Section -->
                        <div>
                            <div style="aspect-ratio: 1; background: #f3f4f6; border-radius: 8px; overflow: hidden; position: relative; min-height: 300px; max-width: 300px; margin: 0 auto;">
                                <img id="previewImage" src="https://via.placeholder.com/400x400?text=Upload+Photo" alt="Profile Preview" style="width: 100%; height: 100%; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                                <div id="dragText" style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; color: #666; pointer-events: none;">
                                    Drag to reposition image
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px; max-width: 300px; margin: 10px auto;">
                                <button onclick="zoomOut()" style="padding: 8px; background: #f3f4f6; border-radius: 50%; border: none; cursor: pointer; min-width: 36px; min-height: 36px;">-</button>
                                <input type="range" id="zoomSlider" min="50" max="200" value="100" style="flex: 1;">
                                <button onclick="zoomIn()" style="padding: 8px; background: #f3f4f6; border-radius: 50%; border: none; cursor: pointer; min-width: 36px; min-height: 36px;">+</button>
                            </div>
                        </div>
                        
                        <!-- Controls Section -->
                        <div>
                            <!-- Suit Options -->
                            <div style="margin-bottom: 20px;">
                                <h3 style="font-size: clamp(16px, 3vw, 18px); margin-bottom: 10px;">üëî Select Suit Overlay</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px;">
                                    <div onclick="selectSuit(this)" class="suit-option" style="cursor: pointer; padding: 10px; border: 2px solid #3b82f6; border-radius: 8px;">
                                        <img src="../assets/img/suit-overlay/suit-overlay-1.png" alt="Business Suit" style="width: 100%; border-radius: 4px;">
                                        <span style="display: block; text-align: center; margin-top: 5px; font-size: 14px;">Business</span>
                                    </div>
                                    <div onclick="selectSuit(this)" class="suit-option" style="cursor: pointer; padding: 10px; border: 2px solid transparent; border-radius: 8px;">
                                        <img src="../assets/img/suit-overlay/suit-overlay-2.png" alt="Executive Suit" style="width: 100%; border-radius: 4px;">
                                        <span style="display: block; text-align: center; margin-top: 5px; font-size: 14px;">Executive</span>
                                    </div>
                                    <div onclick="selectSuit(this)" class="suit-option" style="cursor: pointer; padding: 10px; border: 2px solid transparent; border-radius: 8px;">
                                        <img src="../assets/img/suit-overlay/suit-overlay-3.png" alt="Formal Suit" style="width: 100%; border-radius: 4px;">
                                        <span style="display: block; text-align: center; margin-top: 5px; font-size: 14px;">Formal</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Upload Options -->
                            <div style="margin-bottom: 20px;">
                                <h3 style="font-size: clamp(16px, 3vw, 18px); margin-bottom: 10px;">üñºÔ∏è Upload New Image</h3>
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <button onclick="document.getElementById('profile-upload').click()" style="width: 100%; padding: 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: clamp(14px, 2vw, 16px);">Select Photo from Device</button>
                                    <button style="width: 100%; padding: 12px; background: #f3f4f6; color: #333; border: none; border-radius: 6px; cursor: pointer; font-size: clamp(14px, 2vw, 16px);">Take a Selfie</button>
                                </div>
                            </div>
                            
                            <!-- Advanced Settings -->
                            <div>
                                <h3 style="font-size: clamp(16px, 3vw, 18px); margin-bottom: 10px;">‚öôÔ∏è Advanced Settings</h3>
                                <div style="display: flex; flex-direction: column; gap: 10px;">
                                    <label style="display: flex; align-items: center; gap: 10px; font-size: clamp(14px, 2vw, 16px);">
                                        <input type="checkbox" id="bgRemovalCheckbox" onchange="handleBackgroundRemoval(this)">
                                        <span>Automatic background removal</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Footer Actions -->
                    <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; flex-wrap: wrap;">
                        <button onclick="closeModal()" style="padding: 12px 24px; background: #f3f4f6; color: #333; border: none; border-radius: 6px; cursor: pointer; font-size: clamp(14px, 2vw, 16px); min-width: 100px;">Cancel</button>
                        <button onclick="applyChanges()" style="padding: 12px 24px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: clamp(14px, 2vw, 16px); min-width: 100px;">Apply to Resume</button>
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="section-block">
                <h2 class="section-header">Personal Information</h2>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" placeholder="John Doe">
                    </div>
                    <div class="input-group">
                        <label for="title">Professional Title</label>
                        <input type="text" id="title" placeholder="e.g., Software Engineer">
                    </div>
                    <div class="input-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" placeholder="john.doe@example.com">
                    </div>
                    <div class="input-group">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" placeholder="+1 234 567 890">
                            </div>
                            <div class="input-group full-width">
                        <label for="summary">Professional Summary</label>
                        <textarea id="summary" placeholder="Write a brief summary of your professional background..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Technical Skills -->
            <div class="section-block bg-white rounded-lg shadow-sm p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Technical Skills</h2>
                <div class="space-y-8">
                    <!-- Programming Languages -->
                    <div class="skill-category">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Programming Languages</h4>
                        <div class="flex gap-2 mb-3">
                            <input type="text" 
                                   class="skill-input flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition-colors" 
                                   placeholder="e.g., JavaScript, Python, Java">
                            <button class="add-skill-btn px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                Add
                            </button>
                        </div>
                        <div class="skills-list flex flex-wrap gap-2 min-h-[40px] p-2 bg-gray-50 rounded-md"></div>
                    </div>

                    <!-- Frameworks & Libraries -->
                    <div class="skill-category">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Frameworks & Libraries</h4>
                        <div class="flex gap-2 mb-3">
                            <input type="text" 
                                   class="skill-input flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition-colors" 
                                   placeholder="e.g., React, Node.js, Django">
                            <button class="add-skill-btn px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                Add
                            </button>
                        </div>
                        <div class="skills-list flex flex-wrap gap-2 min-h-[40px] p-2 bg-gray-50 rounded-md"></div>
                    </div>

                    <!-- Tools & Technologies -->
                    <div class="skill-category">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Tools & Technologies</h4>
                        <div class="flex gap-2 mb-3">
                            <input type="text" 
                                   class="skill-input flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary focus:border-primary transition-colors" 
                                   placeholder="e.g., Git, Docker, AWS">
                            <button class="add-skill-btn px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                                Add
                            </button>
                        </div>
                        <div class="skills-list flex flex-wrap gap-2 min-h-[40px] p-2 bg-gray-50 rounded-md"></div>
                    </div>
                </div>
            </div>

            <!-- Work Experience -->
            <div class="section-block">
                <h2 class="section-header">Work Experience</h2>
                <div id="work-experience-container">
                    <div class="experience-item">
                            <div class="form-grid">
                                <div class="input-group">
                                <label for="company">Company</label>
                                <input type="text" id="company" placeholder="Company Name">
                                </div>
                                <div class="input-group">
                                <label for="position">Position</label>
                                <input type="text" id="position" placeholder="Job Title">
                                </div>
                                <div class="input-group">
                                <label for="start-date">Start Date</label>
                                <input type="month" id="start-date">
                                </div>
                                <div class="input-group">
                                <label for="end-date">End Date</label>
                                <input type="month" id="end-date">
                                </div>
                            <div class="input-group full-width">
                                <label for="description">Description</label>
                                <textarea id="description" placeholder="Describe your responsibilities and achievements..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="add-experience-btn">Add Another Experience</button>
            </div>

            <!-- Projects -->
            <div class="section-block">
                <h2 class="section-header">Projects</h2>
                    <div id="projects-container">
                        <div class="project-item">
                            <div class="form-grid">
                            <div class="input-group">
                                <label for="project-title">Project Title</label>
                                <input type="text" id="project-title" placeholder="Project Name">
                                </div>
                            <div class="input-group">
                                <label for="project-tech">Technologies Used</label>
                                <input type="text" id="project-tech" placeholder="e.g., React, Node.js, MongoDB">
                                </div>
                                <div class="input-group full-width">
                                <label for="project-desc">Project Description</label>
                                <textarea id="project-desc" placeholder="Describe the project and your role..."></textarea>
                                </div>
                                </div>
                                </div>
                            </div>
                <button class="add-project-btn">Add Another Project</button>
                        </div>
                    </div>

        <div class="right-panel" id="resume-preview">
            <!-- Resume preview will be generated here -->
                </div>
    </main>

    <button class="preview-toggle" id="previewToggle">Preview Resume</button>

    <script src="js/auth.js"></script>
    <script>
           if (!Auth.requireAuth()) {
            // This will redirect to index.html if not authenticated
            // No need for additional code here
        }

        // Get user data from localStorage
        const user = JSON.parse(localStorage.getItem('user'));
        
        // Auto-fill name and email if user is logged in
        if (user) {
            if (user.fullName) {
                document.getElementById('name').value = user.fullName;
            }
            if (user.email) {
                document.getElementById('email').value = user.email;
            }
        }

        // Get template ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const templateId = urlParams.get('template') || 'default';

        // Preview functionality
        const previewToggle = document.getElementById('previewToggle');
        const rightPanel = document.querySelector('.right-panel');
        let isPreviewActive = true; // Start with preview active

        function togglePreview() {
            isPreviewActive = !isPreviewActive;
            rightPanel.classList.toggle('active');
            previewToggle.classList.toggle('active');
            previewToggle.textContent = isPreviewActive ? 'Hide Preview' : 'Preview Resume';
            
            if (isPreviewActive) {
                updatePreview();
            }
        }

        function updatePreview() {
            const previewContainer = document.getElementById('resume-preview');
            
            // Clear previous preview
            previewContainer.innerHTML = '';
            
            // Create preview based on template
            if (templateId === 'it-1') {
                // IT Template 1 Preview
                const preview = document.createElement('div');
                preview.className = 'resume-container';
                preview.innerHTML = `
                    <!-- Header Section -->
                    <header class="header">
                        ${profileImage ? `
                            <div class="profile-picture">
                                <img src="${profileImage}" alt="Profile Picture">
                            </div>
                        ` : ''}
                        <h1>${document.getElementById('name')?.value || 'Your Name'}</h1>
                        <h2>${document.getElementById('title')?.value || 'Professional Title'}</h2>
                        <div class="contact-info">
                            <div class="contact-item">
                                <span>üìß</span>
                                <span>${document.getElementById('email')?.value || 'email@example.com'}</span>
                            </div>
                            <div class="contact-item">
                                <span>üì±</span>
                                <span>${document.getElementById('phone')?.value || '+1 234 567 890'}</span>
                            </div>
                        </div>
                    </header>

                    <!-- Professional Summary Section -->
                    <section class="section">
                        <h3 class="section-title">Professional Summary</h3>
                        <p>${document.getElementById('summary')?.value || 'Your professional summary...'}</p>
                    </section>

                    <!-- Technical Skills Section -->
                    <section class="section">
                        <h3 class="section-title">Technical Skills</h3>
                        <div class="tech-skills" id="skills-preview"></div>
                    </section>

                    <!-- Professional Experience Section -->
                    <section class="section">
                        <h3 class="section-title">Professional Experience</h3>
                        <div id="experience-preview"></div>
                    </section>

                    <!-- Technical Projects Section -->
                    <section class="section">
                        <h3 class="section-title">Technical Projects</h3>
                        <div class="projects" id="projects-preview"></div>
                    </section>
                `;
                previewContainer.appendChild(preview);
            } else {
                // Default template preview
                const preview = document.createElement('div');
                preview.className = 'default-template-preview';
                preview.innerHTML = `
                    <div class="preview-header"> 
                        ${profileImage ? `
                            <div class="profile-picture">
                                <img src="${profileImage}" alt="Profile Picture">
                </div>
                        ` : ''}
                        <h1>${document.getElementById('name')?.value || 'Your Name'}</h1>
                        <h2>${document.getElementById('title')?.value || 'Professional Title'}</h2>
                        <div class="contact-info">
                            <p>${document.getElementById('email')?.value || 'email@example.com'}</p>
                            <p>${document.getElementById('phone')?.value || '+1 234 567 890'}</p>
            </div>
                    </div>
                    <div class="preview-summary">
                        <h3>Professional Summary</h3>
                        <p>${document.getElementById('summary')?.value || 'Your professional summary...'}</p>
                    </div>
                `;
                previewContainer.appendChild(preview);
            }

            // Update skills preview
            const skillsLists = document.querySelectorAll('.skills-list');
            const skillsPreview = previewContainer.querySelector('#skills-preview');
            if (skillsPreview) {
                skillsPreview.innerHTML = '';
                skillsLists.forEach(list => {
                    const skills = Array.from(list.querySelectorAll('.skill-badge'))
                        .map(badge => badge.textContent.replace('√ó', '').trim());
                    if (skills.length > 0) {
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'skill-category';
                        categoryDiv.innerHTML = `
                            <h4>${list.previousElementSibling.previousElementSibling.textContent}</h4>
                            <ul class="skill-list">
                                ${skills.map(skill => `<li>${skill}</li>`).join('')}
                            </ul>
                        `;
                        skillsPreview.appendChild(categoryDiv);
                    }
                });
            }

            // Update experience preview
            const experienceItems = document.querySelectorAll('.experience-item');
            const experiencePreview = previewContainer.querySelector('#experience-preview');
            if (experiencePreview) {
                experiencePreview.innerHTML = '';
                experienceItems.forEach(item => {
                    const company = item.querySelector('input[placeholder="Company Name"]')?.value;
                    const position = item.querySelector('input[placeholder="Job Title"]')?.value;
                    const startDate = item.querySelector('input[type="month"]:first-of-type')?.value;
                    const endDate = item.querySelector('input[type="month"]:last-of-type')?.value;
                    const description = item.querySelector('textarea')?.value;

                    if (company || position) {
                        const experienceDiv = document.createElement('div');
                        experienceDiv.className = 'experience-item';
                        experienceDiv.innerHTML = `
                            <div class="experience-header">
                                <div class="experience-title">${position || 'Position'}</div>
                                <div class="experience-date">${startDate || 'Start Date'} - ${endDate || 'End Date'}</div>
                            </div>
                            <div class="experience-company">${company || 'Company'}</div>
                            <div class="experience-description">
                                <p>${description || 'Description'}</p>
                            </div>
                        `;
                        experiencePreview.appendChild(experienceDiv);
                    }
                });
            }

            // Update projects preview
            const projectItems = document.querySelectorAll('.project-item');
            const projectsPreview = previewContainer.querySelector('#projects-preview');
            if (projectsPreview) {
                projectsPreview.innerHTML = '';
                projectItems.forEach(item => {
                    const title = item.querySelector('input[placeholder="Project Name"]')?.value;
                    const tech = item.querySelector('input[placeholder="e.g., React, Node.js, MongoDB"]')?.value;
                    const description = item.querySelector('textarea')?.value;

                    if (title || description) {
                        const projectDiv = document.createElement('div');
                        projectDiv.className = 'project-item';
                        projectDiv.innerHTML = `
                            <div class="project-header">
                                <div class="project-title">${title || 'Project Title'}</div>
                                <div>2023</div>
                            </div>
                            <p>${description || 'Project Description'}</p>
                            ${tech ? `
                                <div class="tech-stack">
                                    ${tech.split(',').map(t => `<span class="tech-badge">${t.trim()}</span>`).join('')}
                                </div>
                            ` : ''}
                        `;
                        projectsPreview.appendChild(projectDiv);
                    }
                });
            }
        }

        // Add Experience Functionality
        const addExperienceBtn = document.querySelector('.add-experience-btn');
        const experienceContainer = document.getElementById('work-experience-container');

        function addExperience() {
            const experienceItem = document.createElement('div');
            experienceItem.className = 'experience-item';
            experienceItem.innerHTML = `
                        <div class="form-grid">
                            <div class="input-group">
                        <label for="company">Company</label>
                        <input type="text" placeholder="Company Name">
                            </div>
                            <div class="input-group">
                        <label for="position">Position</label>
                        <input type="text" placeholder="Job Title">
                            </div>
                            <div class="input-group">
                        <label for="start-date">Start Date</label>
                        <input type="month">
                            </div>
                            <div class="input-group">
                        <label for="end-date">End Date</label>
                        <input type="month">
                            </div>
                    <div class="input-group full-width">
                        <label for="description">Description</label>
                        <textarea placeholder="Describe your responsibilities and achievements..."></textarea>
                        </div>
                    </div>
                <button class="remove-experience-btn">Remove</button>
            `;

            experienceContainer.appendChild(experienceItem);

            // Add auto-resize to new textarea
            const newTextarea = experienceItem.querySelector('textarea');
            if (newTextarea) {
                newTextarea.addEventListener('input', () => {
                    autoResizeTextarea(newTextarea);
                    if (isPreviewActive) {
                        updatePreview();
                    }
                });
            }

            // Add remove functionality
            const removeBtn = experienceItem.querySelector('.remove-experience-btn');
            removeBtn.addEventListener('click', () => {
                experienceItem.remove();
                if (isPreviewActive) {
                    updatePreview();
                }
            });
        }

        addExperienceBtn?.addEventListener('click', addExperience);

        // Add Project Functionality
        const addProjectBtn = document.querySelector('.add-project-btn');
        const projectsContainer = document.getElementById('projects-container');

        function addProject() {
            const projectItem = document.createElement('div');
            projectItem.className = 'project-item';
            projectItem.innerHTML = `
                <div class="form-grid">
                    <div class="input-group">
                        <label for="project-title">Project Title</label>
                        <input type="text" placeholder="Project Name">
                </div>
                    <div class="input-group">
                        <label for="project-tech">Technologies Used</label>
                        <input type="text" placeholder="e.g., React, Node.js, MongoDB">
            </div>
                    <div class="input-group full-width">
                        <label for="project-desc">Project Description</label>
                        <textarea placeholder="Describe the project and your role..."></textarea>
        </div>
    </div>
                <button class="remove-project-btn">Remove</button>
            `;

            projectsContainer.appendChild(projectItem);

            // Add auto-resize to new textarea
            const newTextarea = projectItem.querySelector('textarea');
            if (newTextarea) {
                newTextarea.addEventListener('input', () => {
                    autoResizeTextarea(newTextarea);
                    if (isPreviewActive) {
                        updatePreview();
                    }
                });
            }

            // Add remove functionality
            const removeBtn = projectItem.querySelector('.remove-project-btn');
            removeBtn.addEventListener('click', () => {
                projectItem.remove();
                if (isPreviewActive) {
                    updatePreview();
                }
            });
        }

        addProjectBtn?.addEventListener('click', addProject);

        // Add Skill Functionality
        const addSkillBtns = document.querySelectorAll('.add-skill-btn');

        addSkillBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const container = e.target.closest('.skill-category');
                const input = container.querySelector('.skill-input');
                const skillsList = container.querySelector('.skills-list');
                
                if (input.value.trim()) {
                    const skillBadge = document.createElement('span');
                    skillBadge.className = 'skill-badge';
                    skillBadge.textContent = input.value;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-skill-btn';
                    removeBtn.textContent = '√ó';
                    removeBtn.addEventListener('click', () => {
                        skillBadge.style.animation = 'fadeOut 0.2s ease-out';
                        setTimeout(() => {
                            skillBadge.remove();
                            if (isPreviewActive) {
                                updatePreview();
                            }
                        }, 200);
                    });
                    
                    skillBadge.appendChild(removeBtn);
                    skillsList.appendChild(skillBadge);
                    input.value = '';
                    
                    if (isPreviewActive) {
                        updatePreview();
                    }
                }
            });
        });

        // Add enter key support for adding skills
        document.querySelectorAll('.skill-input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const addBtn = input.nextElementSibling;
                    addBtn.click();
                }
            });
        });

        // Add event listeners
        previewToggle.addEventListener('click', togglePreview);

        // Auto-resize textareas
        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 300) + 'px';
        }

        // Add auto-resize to all textareas
        document.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('input', () => {
                autoResizeTextarea(textarea);
                if (isPreviewActive) {
                    updatePreview();
                }
            });
        });

        // Close preview when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && 
                isPreviewActive && 
                !rightPanel.contains(e.target) && 
                !previewToggle.contains(e.target)) {
                togglePreview();
            }
        });

        // Update preview when form inputs change
        document.querySelectorAll('.input-group input, .input-group textarea').forEach(input => {
            input.addEventListener('input', () => {
                if (isPreviewActive) {
                    updatePreview();
                }
            });
        });

        // Handle window resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (window.innerWidth > 768 && isPreviewActive) {
                    rightPanel.classList.remove('active');
                    previewToggle.classList.remove('active');
                    previewToggle.textContent = 'Preview Resume';
                    isPreviewActive = false;
                }
            }, 250);
        });

        // Initialize preview state
        if (window.innerWidth <= 768) {
            previewToggle.style.display = 'block';
        }

        // Show preview immediately when page loads
    

      // Initialize user menu
        Auth.updateUserMenu();
        Auth.initUserMenu();

        // Profile Picture Upload Functionality
        const profileUpload = document.getElementById('profile-upload');
        const profilePreview = document.querySelector('.profile-preview');
        const removePhoto = document.querySelector('.remove-photo');
        let profileImage = null;

        // Update applyChanges function to handle the edited photo
        function applyChanges() {
            const previewImage = document.getElementById('previewImage');
            const profilePreview = document.querySelector('.profile-preview');
            const removePhoto = document.querySelector('.remove-photo');
            
            if (!previewImage.src || previewImage.src.includes('placeholder.com')) {
                alert('Please upload an image first');
                return;
            }

            // Create a canvas to capture exactly what's visible in the editor
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size to match the editor container (300x300)
            canvas.width = 300;
            canvas.height = 300;
            
            // Get the current transform values
            const transform = new WebKitCSSMatrix(getComputedStyle(previewImage).transform);
            const scale = transform.m11; // Get the scale value
            const translateX = transform.m41; // Get the X translation
            const translateY = transform.m42; // Get the Y translation
            
            // Calculate the image dimensions after scaling
            const scaledWidth = previewImage.naturalWidth * scale;
            const scaledHeight = previewImage.naturalHeight * scale;
            
            // Calculate the position to center the image
            const x = translateX + (canvas.width - scaledWidth) / 2;
            const y = translateY + (canvas.height - scaledHeight) / 2;
            
            // Fill the background with white
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw the image exactly as it appears in the editor
            ctx.drawImage(
                previewImage,
                x,
                y,
                scaledWidth,
                scaledHeight
            );
            
            // Convert to PNG and update profile preview
            const finalImage = canvas.toDataURL('image/png');
            profileImage = finalImage;
            
            // Update the profile preview with the new image
            profilePreview.innerHTML = `<img src="${finalImage}" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover;">`;
            
            // Show remove photo button
            if (removePhoto) {
                removePhoto.classList.add('active');
            }
            
            // Update the preview if it's active
            if (isPreviewActive) {
                updatePreview();
            }
            
            // Close the modal
            document.getElementById('profileEditorModal').style.display = 'none';
        }

        // Update file upload handler to not show in preview immediately
        document.getElementById('profile-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImage = document.getElementById('previewImage');
                    previewImage.src = e.target.result;
                    
                    // Reset position and scale when new image is loaded
                    translateX = 0;
                    translateY = 0;
                    previewImage.style.transform = 'translate(-50%, -50%) scale(1)';
                    
                    // Reset zoom slider
                    document.getElementById('zoomSlider').value = 100;
                    
                    // Store the original image for background removal
                    originalImage = e.target.result;
                    
                    // Reset background removal checkbox
                    document.getElementById('bgRemovalCheckbox').checked = false;
                    
                    // Ensure profile preview remains empty until Save to Resume is clicked
                    const profilePreview = document.querySelector('.profile-preview');
                    if (profilePreview) {
                        profilePreview.innerHTML = '<div class="placeholder">üë§</div>';
                    }
                    
                    // Initialize drag and drop for the new image
                    initDragAndDrop();
                };
                reader.readAsDataURL(file);
            }
        });

        // Initialize profile preview to be empty
        document.addEventListener('DOMContentLoaded', function() {
            const profilePreview = document.querySelector('.profile-preview');
            if (profilePreview) {
                profilePreview.innerHTML = '<div class="placeholder">üë§</div>';
            }
        });

        // Modal functions
        function openModal() {
            document.getElementById('profileEditorModal').style.display = 'block';
            // Initialize drag and drop when modal opens
            initDragAndDrop();
        }

        function closeModal() {
            document.getElementById('profileEditorModal').style.display = 'none';
        }

        function selectSuit(element) {
            document.querySelectorAll('.suit-option').forEach(opt => {
                opt.style.borderColor = 'transparent';
            });
            element.style.borderColor = '#3b82f6';
        }

        function zoomIn() {
            const slider = document.getElementById('zoomSlider');
            slider.value = parseInt(slider.value) + 10;
            updateZoom();
        }

        function zoomOut() {
            const slider = document.getElementById('zoomSlider');
            slider.value = parseInt(slider.value) - 10;
            updateZoom();
        }

        function updateZoom() {
            const slider = document.getElementById('zoomSlider');
            const image = document.getElementById('previewImage');
            const container = image.parentElement;
            
            // Calculate the scale based on slider value
            const scale = slider.value / 100;
            
            // Calculate bounds
            const rect = container.getBoundingClientRect();
            const imageWidth = image.naturalWidth * scale;
            const imageHeight = image.naturalHeight * scale;
            const maxX = (imageWidth - rect.width) / 2;
            const maxY = (imageHeight - rect.height) / 2;
            
            // Constrain the translation within bounds
            translateX = Math.max(-maxX, Math.min(maxX, translateX));
            translateY = Math.max(-maxY, Math.min(maxY, translateY));
            
            // Update the transform to include both translation and scale
            image.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        // Add drag functionality
        let isDragging = false;
        let startX, startY, translateX = 0, translateY = 0;

        function initDragAndDrop() {
            const image = document.getElementById('previewImage');
            const container = image.parentElement;
            
            // Make container relative for absolute positioning of image
            container.style.position = 'relative';
            container.style.overflow = 'hidden'; // Keep overflow hidden to contain the image
            
            // Make image absolute for dragging
            image.style.position = 'absolute';
            image.style.cursor = 'move';
            image.style.userSelect = 'none';
            image.style.maxWidth = 'none';
            image.style.maxHeight = 'none';
            
            // Center the image initially
            image.style.top = '50%';
            image.style.left = '50%';
            image.style.transform = 'translate(-50%, -50%)';
            
            // Mouse events for dragging
            image.addEventListener('mousedown', startDrag);
            image.addEventListener('mousemove', drag);
            image.addEventListener('mouseup', endDrag);
            image.addEventListener('mouseleave', endDrag);
            
            // Touch events for mobile
            image.addEventListener('touchstart', startDrag);
            image.addEventListener('touchmove', drag);
            image.addEventListener('touchend', endDrag);
        }

        function startDrag(e) {
            isDragging = true;
            const image = document.getElementById('previewImage');
            
            if (e.type === 'touchstart') {
                startX = e.touches[0].clientX - translateX;
                startY = e.touches[0].clientY - translateY;
            } else {
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
            }
            
            // Hide drag text when dragging starts
            const dragText = document.getElementById('dragText');
            if (dragText) {
                dragText.style.display = 'none';
            }
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const image = document.getElementById('previewImage');
            const container = image.parentElement;
            const rect = container.getBoundingClientRect();
            
            let currentX, currentY;
            if (e.type === 'touchmove') {
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
            } else {
                currentX = e.clientX;
                currentY = e.clientY;
            }
            
            // Calculate new position
            let newTranslateX = currentX - startX;
            let newTranslateY = currentY - startY;
            
            // Get the current scale
            const scale = document.getElementById('zoomSlider').value / 100;
            
            // Calculate image dimensions
            const imageWidth = image.naturalWidth * scale;
            const imageHeight = image.naturalHeight * scale;
            
            // Calculate bounds
            const maxX = (imageWidth - rect.width) / 2;
            const maxY = (imageHeight - rect.height) / 2;
            
            // Constrain the translation within bounds
            translateX = Math.max(-maxX, Math.min(maxX, newTranslateX));
            translateY = Math.max(-maxY, Math.min(maxY, newTranslateY));
            
            // Apply the translation
            image.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        function endDrag() {
            isDragging = false;
            
            // Show drag text when dragging ends
            const dragText = document.getElementById('dragText');
            if (dragText) {
                dragText.style.display = 'flex';
            }
        }

        // Background removal functionality
        let originalImage = null; // Store the original image

        async function handleBackgroundRemoval(checkbox) {
            const previewImage = document.getElementById('previewImage');
            
            if (!previewImage.src || previewImage.src.includes('placeholder.com')) {
                alert('Please upload an image first');
                checkbox.checked = false;
                return;
            }

            try {
                if (checkbox.checked) {
                    // Store original image if not already stored
                    if (!originalImage) {
                        originalImage = previewImage.src;
                    }

                    // Show loading state
                    const loadingText = document.createElement('div');
                    loadingText.style.position = 'absolute';
                    loadingText.style.top = '50%';
                    loadingText.style.left = '50%';
                    loadingText.style.transform = 'translate(-50%, -50%)';
                    loadingText.style.color = '#666';
                    loadingText.textContent = 'Removing background...';
                    previewImage.parentElement.appendChild(loadingText);

                    // Convert image to blob
                    const response = await fetch(previewImage.src);
                    const blob = await response.blob();

                    // Create form data
                    const formData = new FormData();
                    formData.append('image_file', blob);

                    // Call background removal API
                    const apiResponse = await fetch('https://api.remove.bg/v1.0/removebg', {
                        method: 'POST',
                        headers: {
                            'X-Api-Key': process.env.REMOVE_BG_API_KEY || '',
                        },
                        body: formData,
                    });

                    if (!apiResponse.ok) {
                        throw new Error('Failed to remove background');
                    }

                    // Convert response to blob and create URL
                    const processedBlob = await apiResponse.blob();
                    const processedUrl = URL.createObjectURL(processedBlob);

                    // Update image
                    previewImage.src = processedUrl;
                    loadingText.remove();
                } else {
                    // Revert to original image if available
                    if (originalImage) {
                        previewImage.src = originalImage;
                    }
                }
            } catch (error) {
                console.error('Error removing background:', error);
                alert('Failed to remove background. Please try again.');
                checkbox.checked = false;
            }
        }

        // AI Enhancement functionality
        let currentTextarea = null;
        let currentPopup = null;
        // TODO: Set up your OpenAI API key in your environment variables
        // const API_KEY = process.env.OPENAI_API_KEY || '';

        function addAIEnhanceButtons() {
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                const container = textarea.parentElement;
                if (!container.querySelector('.ai-enhance-btn')) {
                    // Create button
                    const aiButton = document.createElement('button');
                    aiButton.className = 'ai-enhance-btn';
                    aiButton.innerHTML = 'Get help with AI assistant';
                    aiButton.onclick = (e) => {
                        e.stopPropagation();
                        openAIEnhancePopup(textarea, aiButton);
                    };
                    container.style.position = 'relative';
                    container.appendChild(aiButton);

                    // Create popup
                    const popup = document.createElement('div');
                    popup.className = 'ai-enhance-popup';
                    popup.innerHTML = '<div class="ai-loading">Generating suggestions</div>';
                    container.appendChild(popup);
                }
            });
        }

        // Initialize AI enhancement buttons
        document.addEventListener('DOMContentLoaded', function() {
            addAIEnhanceButtons();
        });

        // Add AI enhancement buttons when new sections are added
        const originalAddSection = addSection;
        addSection = function() {
            originalAddSection();
            addAIEnhanceButtons();
        };

        async function getAISuggestions(text) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: "You are a professional resume writer. Provide 3 different versions of the given text: 1) A professional version with impact, 2) A concise version that's clear and direct, 3) A detailed version with more context. Keep the core meaning but enhance the language and structure."
                            },
                            {
                                role: "user",
                                content: text
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 500
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const suggestions = data.choices[0].message.content.split('\n\n').filter(s => s.trim());
                return suggestions;
            } catch (error) {
                console.error('Error getting AI suggestions:', error);
                return [
                    "Professional version: " + text + " (enhanced for impact)",
                    "Concise version: " + text + " (clear and direct)",
                    "Detailed version: " + text + " (with more context)"
                ];
            }
        }

        function openAIEnhancePopup(textarea, button) {
            // Close any open popups
            if (currentPopup) {
                currentPopup.style.display = 'none';
            }

            currentTextarea = textarea;
            currentPopup = button.nextElementSibling;
            
            // Show popup and start generating
            currentPopup.style.display = 'block';
            currentPopup.innerHTML = '<div class="ai-loading">Generating suggestions</div>';
            
            // Get the current text
            const currentText = textarea.value;
            
            // Get AI suggestions
            getAISuggestions(currentText).then(suggestions => {
                currentPopup.innerHTML = `
                    ${suggestions.map(text => `
                        <div class="ai-suggestion" onclick="applyEnhancement('${text.replace(/'/g, "\\'")}')">
                            ${text}
                        </div>
                    `).join('')}
                    <button class="regenerate-btn" onclick="regenerateSuggestions('${currentText.replace(/'/g, "\\'")}')">
                        üîÑ Regenerate
                    </button>
                `;
            });
        }

        function regenerateSuggestions(text) {
            const regenerateBtn = currentPopup.querySelector('.regenerate-btn');
            regenerateBtn.classList.add('loading');
            regenerateBtn.innerHTML = 'üîÑ Regenerating...';
            
            getAISuggestions(text).then(suggestions => {
                currentPopup.innerHTML = `
                    ${suggestions.map(text => `
                        <div class="ai-suggestion" onclick="applyEnhancement('${text.replace(/'/g, "\\'")}')">
                            ${text}
                        </div>
                    `).join('')}
                    <button class="regenerate-btn" onclick="regenerateSuggestions('${text.replace(/'/g, "\\'")}')">
                        üîÑ Regenerate
                    </button>
                `;
            });
        }

        function applyEnhancement(text) {
            if (currentTextarea) {
                currentTextarea.value = text;
                if (currentPopup) {
                    currentPopup.style.display = 'none';
                }
            }
        }

        // Close popup when clicking outside
        document.addEventListener('click', function(e) {
            if (currentPopup && !currentPopup.contains(e.target) && !e.target.classList.contains('ai-enhance-btn')) {
                currentPopup.style.display = 'none';
            }
        });
    </script>
</body>

</html>

